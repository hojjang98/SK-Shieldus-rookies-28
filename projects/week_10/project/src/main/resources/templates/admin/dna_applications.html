<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/default :: layout(~{::section})}">

<body>
    <section>
        <div class="mb-4">
            <h3 class="fw-bold text-white mb-2">관리자 대시보드</h3>
            <p class="text-muted small">DNA 검사 신청 현황 관리 및 검사 결과 업로드, 사용자 관리를 수행합니다.</p>
        </div>

        <div class="row g-4">
            <!-- Application Management -->
            <div class="col-lg-8">
                <div class="card p-4 border-0 shadow-sm h-100">
                    <h5 class="fw-bold text-white mb-3">검사 신청 승인/거부</h5>
                    <p class="text-muted small mb-3">신청 상태를 변경하고 검사 결과를 업로드할 수 있습니다.</p>

                    <div class="table-responsive mb-4">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="py-2 px-3" style="width: 8%;">번호</th>
                                    <th class="py-2 px-3" style="width: 25%;">신청자</th>
                                    <th class="py-2 px-3" style="width: 15%;">작성자</th>
                                    <th class="py-2 px-3" style="width: 15%;">상태</th>
                                    <th class="py-2 px-3" style="width: 37%;">변경</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:if="${applications == null || #lists.isEmpty(applications)}">
                                    <td colspan="5" class="text-center py-4 text-muted small">신청 내역이 없습니다.</td>
                                </tr>
                                <tr th:each="b : ${applications}">
                                    <td class="px-3 text-muted small" th:text="${b.id}"></td>
                                    <td class="px-3">
                                        <a th:href="@{/board/view(id=${b.id})}" class="fw-bold text-decoration-none"
                                            th:text="${b.title}"></a>
                                    </td>
                                    <td class="px-3 text-muted" th:text="${b.writer}"></td>
                                    <td class="px-3"
                                        th:text="${statusMap[b.id] != null ? statusMap[b.id].status : '접수'}"></td>
                                    <td class="px-3">
                                        <form action="/admin/dna/status" method="post" class="d-flex gap-2">
                                            <input type="hidden" name="boardId" th:value="${b.id}">
                                            <select name="status" class="form-select form-select-sm">
                                                <option value="접수">접수</option>
                                                <option value="승인">승인</option>
                                                <option value="거부">거부</option>
                                                <option value="검사 진행">검사 진행</option>
                                                <option value="결과 업로드">결과 업로드</option>
                                            </select>
                                            <button class="btn btn-sm btn-primary text-nowrap">변경</button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <hr class="border-secondary border-opacity-25 my-4">

                    <h5 class="fw-bold text-white mb-3">검사 결과 업로드</h5>
                    <form action="/admin/dna/result/upload" method="post" enctype="multipart/form-data"
                        class="row g-3 align-items-end">
                        <div class="col-md-2">
                            <label class="form-label fw-bold small text-muted">신청 번호</label>
                            <input type="number" name="boardId" class="form-control" required placeholder="ID"
                                value="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold small text-muted">분석 항목</label>
                            <select name="category" class="form-select">
                                <option value="조상 분석 (DNA Ancestry)">조상 분석 (DNA Ancestry)</option>
                                <option value="질병 위험도 (Health Risk)">질병 위험도 (Health Risk)</option>
                                <option value="약물 반응성 (Drug Response)">약물 반응성 (Drug Response)</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold small text-muted">PDF 파일</label>
                            <input type="file" name="file" class="form-control" accept=".pdf,application/pdf" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label d-none d-md-block">&nbsp;</label>
                            <button class="btn btn-success fw-bold w-100 text-white text-nowrap"><i
                                    class="bi bi-upload me-1"></i>
                                업로드</button>
                        </div>
                    </form>
                    <div class="form-text mt-2 small text-muted"><i class="bi bi-info-circle me-1"></i> 업로드 후 자동으로 해당 신청
                        건의 상태가 "결과 업로드"로 변경됩니다.</div>
                </div>
            </div>

            <!-- User Management -->
            <div class="col-lg-4">
                <div class="card p-4 border-0 shadow-sm h-100">
                    <h5 class="fw-bold text-white mb-3">사용자 관리</h5>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="py-2 px-3">ID</th>
                                    <th class="py-2 px-3">아이디</th>
                                    <th class="py-2 px-3">권한</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="u : ${users}">
                                    <td class="px-3 text-muted small" th:text="${u.id}"></td>
                                    <td class="px-3 fw-bold" th:text="${u.username}"></td>
                                    <td class="px-3">
                                        <span
                                            class="badge bg-secondary bg-opacity-25 text-body border border-secondary border-opacity-25"
                                            th:text="${u.role}"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>

</html>