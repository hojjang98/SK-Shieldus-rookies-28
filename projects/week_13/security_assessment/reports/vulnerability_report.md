# 보안 취약점 진단 보고서

## 1. 진단 개요

### 진단 대상
- 시스템명: E-Commerce 웹 애플리케이션
- URL: http://localhost:5000
- 진단일자: 2026년 1월 26일
- 진단자: 호짱

### 진단 범위
- 웹 애플리케이션 취약점 점검
- 로그인/회원가입 기능
- 상품 검색 및 조회
- 댓글 시스템
- 파일 업로드 기능

### 진단 방법
- 자동화 스캔: OWASP ZAP
- 수동 진단: Python 스크립트 및 브라우저 테스트

---

## 2. 진단 결과 요약

| 심각도 | 개수 | 상세 |
|--------|------|------|
| Critical | 2 | SQL Injection (로그인, 검색) |
| High | 2 | XSS, 파일 업로드 취약점 |
| Medium | 3 | CSRF 토큰 없음, CSP 미설정, Clickjacking |
| Low | 5 | 보안 헤더 누락 |
| Info | 6 | 정보성 항목 |

---

## 3. Critical 취약점

### 3.1 SQL Injection - 로그인 우회

**위치**: `/login`

**설명**  
로그인 폼에서 SQL Injection을 통해 인증 우회가 가능합니다.

**공격 시연**
```
Username: admin' OR '1'='1
Password: anything
결과: 로그인 성공
```

**취약 코드**
```python
query = f"SELECT * FROM users WHERE username='{username}' AND password='{password}'"
```

**영향**
- 관리자 계정 탈취 가능
- 무단 로그인
- 권한 상승

**개선 방안**
```python
cursor.execute('SELECT * FROM users WHERE username=? AND password=?', (username, password))
```

---

### 3.2 SQL Injection - 검색 필터 우회

**위치**: `/?search=`

**설명**  
상품 검색 기능에서 SQL Injection으로 모든 데이터 노출이 가능합니다.

**공격 시연**
```
검색어: ' OR '1'='1
결과: 전체 상품(10개) 노출
```

**취약 코드**
```python
query = f"SELECT * FROM products WHERE name LIKE '%{search}%'"
```

**영향**
- 데이터베이스 정보 노출
- 검색 필터 우회

**개선 방안**
```python
cursor.execute('SELECT * FROM products WHERE name LIKE ?', (f'%{search}%',))
```

---

## 4. High 취약점

### 4.1 XSS (Cross-Site Scripting)

**위치**: `/product/<id>` 댓글 기능

**설명**  
댓글에 악성 스크립트 삽입 시 그대로 실행됩니다.

**공격 시연**
```html
<script>alert('XSS')</script>
```

**취약 코드**
```html
<p>{{ comment.comment|safe }}</p>
```

**영향**
- 세션 쿠키 탈취
- 사용자 브라우저 제어
- 피싱 공격

**개선 방안**
```html
<p>{{ comment.comment }}</p>
<!-- |safe 필터 제거 -->
```

---

### 4.2 파일 업로드 취약점

**위치**: `/profile` 프로필 이미지 업로드

**설명**  
파일 확장자 검증이 없어 악성 파일 업로드가 가능합니다.

**공격 시연**
- test.txt 파일 업로드 성공
- 파일 타입 제한 없음

**취약 코드**
```python
filename = file.filename
filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
file.save(filepath)
```

**영향**
- 웹쉘 업로드
- 서버 장악
- 악성코드 유포

**개선 방안**
```python
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}

def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS
```

---

## 5. Medium 취약점

### 5.1 CSRF 토큰 부재

**위치**: `/login`, `/register`, `/profile`

**설명**  
CSRF 공격 방어 메커니즘이 없습니다.

**영향**  
사용자 의도와 무관한 요청 실행 가능

**개선 방안**  
Flask-WTF를 사용한 CSRF 토큰 적용

---

### 5.2 Content Security Policy 미설정

**영향**  
XSS 공격에 대한 방어층 부족

**개선 방안**
```python
@app.after_request
def set_csp(response):
    response.headers['Content-Security-Policy'] = "default-src 'self'"
    return response
```

---

### 5.3 Clickjacking 방어 헤더 없음

**영향**  
iframe을 통한 클릭재킹 공격 가능

**개선 방안**
```python
response.headers['X-Frame-Options'] = 'DENY'
```

---

## 6. Low 취약점

### 6.1 쿠키 SameSite 속성 없음
세션 쿠키에 SameSite 속성 미설정

### 6.2 서버 버전 정보 노출
응답 헤더에 Werkzeug/2.2.3 Python/3.11.4 노출

### 6.3 X-Content-Type-Options 헤더 없음
MIME 스니핑 공격 가능

### 6.4 Permissions Policy 미설정
브라우저 기능 접근 제한 없음

### 6.5 Cross-Origin 헤더 없음
Spectre 공격에 취약

---

## 7. 종합 권고사항

### 즉시 조치 필요 (Critical/High)
1. SQL Injection 방어: Prepared Statement 적용
2. XSS 방어: HTML 이스케이프 처리
3. 파일 업로드 검증: 화이트리스트 방식 적용

### 단기 조치 (Medium)
1. CSRF 토큰 적용
2. CSP 헤더 설정
3. Clickjacking 방어 헤더 추가

### 장기 조치 (Low)
1. 보안 헤더 종합 적용
2. 서버 정보 은닉
3. 쿠키 보안 속성 강화

---

## 8. 참고자료

- OWASP Top 10
- OWASP ZAP Scanning Report
- 수동 진단 스크립트 결과