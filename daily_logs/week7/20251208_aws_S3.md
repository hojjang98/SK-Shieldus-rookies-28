## 📄 2025.12.08 (Day 30) [AWS 스토리지 서비스: S3, EBS, 데이터 전송]

-----

## 1\. 핵심 개념 정리 (Concepts & Theory)

| \# | 핵심 개념 | 간결한 설명 | 실무/보안 관점에서의 중요성 |
|:---:|:---|:---|:---|
| **1** | **Amazon S3 (Simple Storage Service)** | AWS의 **객체 스토리지 서비스**입니다. 버킷(Bucket)이라는 컨테이너에 객체(파일+메타데이터)를 저장하며, **무제한 확장**이 가능합니다. **99.999999999%(11 9's)**의 내구성을 제공합니다. | **데이터 레이크, 백업, 정적 웹 호스팅**의 핵심입니다. **Block Public Access**를 기본 활성화하고, 버킷 정책과 ACL을 통해 접근 제어를 철저히 해야 합니다. 민감 데이터는 **서버측 암호화(SSE-S3/KMS)**를 반드시 적용해야 합니다. |
| **2** | **S3 버킷 정책 & ACL** | 버킷 정책은 **JSON 형식의 리소스 기반 정책**으로 교차 계정 접근도 허용 가능합니다. ACL은 **객체/버킷 단위의 접근 제어 목록**으로 퍼블릭 접근 설정 시 사용됩니다. | **최소 권한 원칙** 적용이 필수입니다. `Principal: "*"`가 포함된 정책은 **데이터 유출 위험**이 있으므로 주의해야 합니다. CloudTrail에서 **PutBucketPolicy, PutBucketAcl** 이벤트를 모니터링해야 합니다. |
| **3** | **S3 버전 관리 (Versioning)** | 동일한 키에 대해 **여러 버전의 객체를 유지**하는 기능입니다. 실수로 삭제하거나 덮어써도 이전 버전으로 **복구**할 수 있습니다. | **랜섬웨어 공격 대응**에 필수입니다. 버전 관리가 활성화되면 Delete 작업도 Delete Marker만 추가되어 실제 데이터는 보존됩니다. MFA Delete를 활성화하면 추가 보안 계층을 제공합니다. |
| **4** | **S3 암호화 (Encryption)** | **SSE-S3**: S3 관리형 키, **SSE-KMS**: AWS KMS 키(감사 추적 가능), **SSE-C**: 고객 제공 키, **클라이언트 측 암호화**: 업로드 전 암호화 등 다양한 옵션이 있습니다. | **규정 준수(GDPR, HIPAA)**를 위해 암호화는 필수입니다. SSE-KMS를 사용하면 **CloudTrail에서 키 사용 로그**를 추적할 수 있어 감사에 유리합니다. 기본 암호화 설정을 버킷 레벨에서 강제할 수 있습니다. |
| **5** | **S3 스토리지 클래스** | **Standard**(빈번한 접근), **IA**(비빈번 접근), **Glacier**(아카이브), **Intelligent-Tiering**(자동 계층화) 등 **용도별 저장 계층**입니다. 비용과 검색 시간이 다릅니다. | **비용 최적화**의 핵심입니다. 수명 주기 정책(Lifecycle Policy)을 사용하여 오래된 데이터를 자동으로 **저렴한 계층으로 전환**하거나 삭제할 수 있습니다. Glacier에서 복원 시 시간이 소요됨을 인지해야 합니다. |
| **6** | **S3 정적 웹사이트 호스팅** | S3 버킷을 **웹 서버로 사용**하여 HTML, CSS, JS 등 정적 콘텐츠를 호스팅하는 기능입니다. 별도 서버 없이 **서버리스 웹사이트**를 구축할 수 있습니다. | **CloudFront(CDN)**와 결합하면 전 세계에 빠르게 배포 가능합니다. Route 53으로 **커스텀 도메인**을 연결하고, ACM으로 **HTTPS**를 적용하는 것이 보안 모범 사례입니다. |
| **7** | **Amazon EBS (Elastic Block Store)** | EC2 인스턴스에 연결하여 사용하는 **블록 레벨 스토리지**입니다. 파일 시스템을 생성하여 OS, DB 등을 저장합니다. **단일 AZ**에 종속되며, 스냅샷으로 백업합니다. | **데이터 영속성 및 성능**에 핵심입니다. **EBS 볼륨 암호화**를 통해 미사용 데이터를 보호해야 합니다. 인스턴스 종료 시 **Delete on Termination** 설정을 확인하여 의도치 않은 데이터 삭제를 방지해야 합니다. |
| **8** | **VPC Endpoint (Gateway)** | **프라이빗 서브넷에서 인터넷을 거치지 않고** S3/DynamoDB에 직접 접근할 수 있게 하는 서비스입니다. 라우팅 테이블에 엔드포인트 경로가 추가됩니다. | **보안 강화 및 비용 절감**에 필수입니다. NAT Gateway 없이도 S3 접근이 가능해 **NAT 비용을 절약**합니다. 엔드포인트 정책으로 접근 가능한 버킷을 제한할 수 있습니다. Gateway Endpoint는 **무료**입니다. |

-----

## 2\. 실습 코드 & 응용 (Practice & Code Walkthrough)

### (A) S3 버킷 생성 및 파일 관리 (실습 12)

**S3 버킷 생성 (AWS CLI):**

```bash
# 1. 버킷 생성 (리전 지정)
aws s3 mb s3://oooo-labbucket-1234 --region ap-northeast-2

# 2. 파일 업로드
aws s3 cp myfile.txt s3://oooo-labbucket-1234/

# 3. 파일 다운로드
aws s3 cp s3://oooo-labbucket-1234/myfile.txt ./downloaded.txt

# 4. 버킷 내 객체 목록 확인
aws s3 ls s3://oooo-labbucket-1234/
```

**버전 관리 활성화:**

```bash
# 버전 관리 활성화
aws s3api put-bucket-versioning \
  --bucket oooo-labbucket-1234 \
  --versioning-configuration Status=Enabled

# 버전 관리 상태 확인
aws s3api get-bucket-versioning --bucket oooo-labbucket-1234

# 객체 버전 목록 확인
aws s3api list-object-versions --bucket oooo-labbucket-1234
```

### (B) S3 퍼블릭 접근 설정 (실습 13)

**Block Public Access 비활성화 및 ACL 설정:**

```bash
# 1. Block Public Access 비활성화 (주의: 보안 위험!)
aws s3api put-public-access-block \
  --bucket oooo-labbucket-1234 \
  --public-access-block-configuration \
  "BlockPublicAcls=false,IgnorePublicAcls=false,BlockPublicPolicy=false,RestrictPublicBuckets=false"

# 2. 객체에 퍼블릭 읽기 ACL 부여
aws s3api put-object-acl \
  --bucket oooo-labbucket-1234 \
  --key myfile.txt \
  --acl public-read

# 3. 퍼블릭 URL로 접근 테스트
# https://oooo-labbucket-1234.s3.ap-northeast-2.amazonaws.com/myfile.txt

# ⚠️ 실습 후 반드시 Block Public Access 다시 활성화!
aws s3api put-public-access-block \
  --bucket oooo-labbucket-1234 \
  --public-access-block-configuration \
  "BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"
```

### (C) S3 정적 웹사이트 호스팅 (실습 14)

**정적 웹사이트 설정:**

```bash
# 1. 정적 웹사이트 호스팅 활성화
aws s3 website s3://oooo-labbucket-1234 \
  --index-document index.html \
  --error-document error.html

# 2. index.html 업로드
cat << 'EOF' > index.html
<!DOCTYPE html>
<html>
<head><title>Static Web Site</title></head>
<body><h1>Static Web Test!!</h1></body>
</html>
EOF
aws s3 cp index.html s3://oooo-labbucket-1234/

# 3. 버킷 정책 설정 (퍼블릭 읽기 허용)
cat << 'EOF' > bucket-policy.json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::oooo-labbucket-1234/*"
    }
  ]
}
EOF
aws s3api put-bucket-policy --bucket oooo-labbucket-1234 --policy file://bucket-policy.json

# 웹사이트 URL: http://oooo-labbucket-1234.s3-website.ap-northeast-2.amazonaws.com
```

### (D) VPC Gateway Endpoint로 S3 연결 (실습 15)

**Gateway VPC Endpoint 생성:**

```bash
# 1. VPC Endpoint 생성 (S3용)
aws ec2 create-vpc-endpoint \
  --vpc-id vpc-0abcdef1234567890 \
  --service-name com.amazonaws.ap-northeast-2.s3 \
  --route-table-ids rtb-0privateroutableid \
  --vpc-endpoint-type Gateway

# 2. 라우팅 테이블에 엔드포인트 경로가 자동 추가됨 확인
aws ec2 describe-route-tables --route-table-ids rtb-0privateroutableid

# 3. Private EC2에서 S3 접근 테스트 (User Data)
#!/bin/bash
echo "Test file" > /tmp/s3test.txt
aws s3 mb s3://oooo-s3-gw-endpoint-test-01
aws s3 cp /tmp/s3test.txt s3://oooo-s3-gw-endpoint-test-01/
```

### (E) EBS 볼륨 생성 및 연결 (실습 7)

**EBS 볼륨 생성 및 마운트:**

```bash
# 1. EBS 볼륨 생성 (gp3, 1GB, 동일 AZ 필수)
aws ec2 create-volume \
  --availability-zone ap-northeast-2a \
  --size 1 \
  --volume-type gp3 \
  --tag-specifications 'ResourceType=volume,Tags=[{Key=Name,Value=oooo-data-volume}]'

# 2. EC2 인스턴스에 볼륨 연결
aws ec2 attach-volume \
  --volume-id vol-0volumeid \
  --instance-id i-0instanceid \
  --device /dev/sdf

# 3. EC2 내부에서 파일시스템 생성 및 마운트
sudo mkfs -t ext4 /dev/sdf        # 파일시스템 생성
sudo mkdir /appdir                 # 마운트 포인트 생성
sudo mount /dev/sdf /appdir        # 마운트
df -k                              # 마운트 확인

# 4. 테스트 파일 생성
cd /appdir
echo "Test" > testfile
ls

# 5. 볼륨 분리 전 umount 필수!
cd /
sudo umount /appdir
```

-----

## 3\. 실무/보안 관점 분석 (Insight & Scenario Mapping)

| 분야 | 적용 시나리오 |
|:---:|:---|
| **스토리지 유형 선택** | **S3 (객체 스토리지)**: 비정형 데이터, 백업, 미디어 파일, 로그, 정적 웹 호스팅에 적합. HTTP/HTTPS로 어디서나 접근 가능. **EBS (블록 스토리지)**: OS 부팅 볼륨, 데이터베이스, 파일 시스템 등 빈번한 읽기/쓰기가 필요한 워크로드에 적합. EC2에 직접 연결 필요. **EFS (파일 스토리지)**: 여러 EC2에서 동시 접근이 필요한 공유 파일 시스템에 적합. |
| **데이터 보호 전략** | **S3**: 버전 관리로 실수/랜섬웨어 대비, Cross-Region Replication으로 DR 구성, 수명 주기 정책으로 자동 아카이빙. **EBS**: 정기 스냅샷 생성, 다른 AZ/리전으로 스냅샷 복사, DLM(Data Lifecycle Manager)으로 스냅샷 자동화. |
| **접근 제어 모범 사례** | **S3**: Block Public Access 기본 활성화, IAM 정책과 버킷 정책 조합, VPC Endpoint로 프라이빗 접근, 서버 액세스 로깅 활성화. **EBS**: 보안 그룹으로 EC2 접근 제어, EBS 볼륨 암호화 필수, IAM으로 스냅샷 공유 범위 제한. |
| **비용 최적화** | **S3**: 스토리지 클래스 적절 선택(Standard → IA → Glacier), 수명 주기 정책으로 자동 전환, 불완전 멀티파트 업로드 자동 삭제. **EBS**: 적절한 볼륨 타입 선택(gp3 vs io2), 미사용 볼륨/스냅샷 정기 삭제, 프로비저닝된 IOPS는 필요한 경우만. |
| **보안 모니터링** | **CloudTrail 모니터링 대상**: `PutBucketPolicy`(정책 변경), `PutBucketAcl`(ACL 변경), `DeleteBucketEncryption`(암호화 해제), `ModifySnapshotAttribute`(스냅샷 공유). **CloudWatch 알람**: S3 버킷 크기 급증, 비정상 API 호출 패턴 감지. |
| **프라이빗 접근 구성** | **Gateway Endpoint (무료)**: S3, DynamoDB 전용. 라우팅 테이블 기반. NAT Gateway 없이 프라이빗 서브넷에서 접근 가능. **Interface Endpoint (유료)**: 대부분의 AWS 서비스 지원. ENI 기반. 온프레미스에서 Direct Connect/VPN 통한 접근 시 필요. |

-----

## 4\. 개인 인사이트 및 다음 단계 (Reflection & Next Steps)

* **배운 점/느낀 점:**

    * **객체 vs 블록 스토리지의 명확한 구분**: S3는 HTTP 기반의 객체 스토리지로 무제한 확장이 가능하고, EBS는 EC2에 직접 연결되는 블록 스토리지로 파일 시스템을 구성한다는 차이를 명확히 이해했습니다. 용도에 따른 적절한 선택이 중요합니다.

    * **S3 보안의 중요성**: Block Public Access, 버킷 정책, ACL 등 다층적인 접근 제어 메커니즘이 존재하며, 실수로 퍼블릭 노출되는 경우 **데이터 유출 사고**로 이어질 수 있음을 깨달았습니다. SOC 관점에서 S3 설정 변경 이벤트 모니터링이 필수입니다.

    * **VPC Endpoint의 가치**: NAT Gateway 없이도 프라이빗 서브넷에서 S3에 접근할 수 있다는 것이 인상적이었습니다. **비용 절감 + 보안 강화**라는 두 가지 이점을 동시에 얻을 수 있습니다. Gateway Endpoint가 무료라는 점도 실무에서 유용합니다.

    * **EBS의 AZ 종속성**: EBS 볼륨은 특정 가용 영역에 종속되므로, **다른 AZ의 EC2에는 연결할 수 없다**는 제약을 이해했습니다. 스냅샷을 활용한 AZ 간 데이터 이동이 DR 전략의 핵심입니다.

* **심화 방향:**

    * **S3 수명 주기 정책 실습**: 30일 후 IA로 전환, 90일 후 Glacier로 전환, 365일 후 삭제하는 수명 주기 정책 구성 및 비용 시뮬레이션.

    * **S3 이벤트 트리거 구성**: S3 파일 업로드 시 Lambda 함수를 트리거하여 이미지 리사이징, 로그 분석 등 이벤트 기반 아키텍처 구현.

    * **EBS 스냅샷 자동화**: AWS DLM(Data Lifecycle Manager)을 사용하여 EBS 스냅샷 생성/삭제를 자동화하고, 다른 리전으로 복사하는 DR 전략 수립.

    * **S3 보안 자동화**: AWS Config Rules로 S3 퍼블릭 접근 여부를 자동 감지하고, Lambda로 자동 수정하는 보안 자동화 파이프라인 구축.

-----

## 5\. 추가 참고사항 (Quick Reference)

### S3 vs EBS vs EFS 비교

| 특성 | S3 | EBS | EFS |
|:---:|:---:|:---:|:---:|
| **스토리지 유형** | 객체 스토리지 | 블록 스토리지 | 파일 스토리지 |
| **접근 방식** | HTTP/HTTPS API | EC2에 직접 연결 | NFS 프로토콜 |
| **확장성** | 무제한 | 최대 64TiB/볼륨 | 자동 확장 |
| **가용 영역** | 리전 내 자동 복제 | 단일 AZ | 다중 AZ |
| **동시 접근** | 무제한 | 단일 EC2 (io1/io2 Multi-Attach 제외) | 수천 개 EC2 |
| **주요 용도** | 백업, 미디어, 로그 | OS, DB, 파일시스템 | 공유 파일 시스템 |
| **내구성** | 99.999999999% (11 9's) | 99.999% | 99.999999999% |

### S3 스토리지 클래스

| 클래스 | 용도 | 검색 시간 | 최소 저장 기간 |
|:---:|:---:|:---:|:---:|
| **Standard** | 빈번한 접근 | 즉시 | 없음 |
| **Intelligent-Tiering** | 접근 패턴 불확실 | 즉시 | 없음 |
| **Standard-IA** | 비빈번 접근 | 즉시 | 30일 |
| **One Zone-IA** | 비빈번, 단일 AZ | 즉시 | 30일 |
| **Glacier Instant** | 아카이브, 즉시 접근 | 밀리초 | 90일 |
| **Glacier Flexible** | 아카이브, 유연한 검색 | 분~시간 | 90일 |
| **Glacier Deep Archive** | 장기 아카이브 | 12~48시간 | 180일 |

### EBS 볼륨 타입

| 타입 | 유형 | 용도 | 최대 IOPS | 최대 처리량 |
|:---:|:---:|:---:|:---:|:---:|
| **gp3** | SSD | 범용 (기본 권장) | 16,000 | 1,000 MB/s |
| **gp2** | SSD | 범용 (레거시) | 16,000 | 250 MB/s |
| **io2** | SSD | 고성능 DB | 64,000 | 1,000 MB/s |
| **io2 Block Express** | SSD | 미션 크리티컬 | 256,000 | 4,000 MB/s |
| **st1** | HDD | 처리량 최적화 | 500 | 500 MB/s |
| **sc1** | HDD | Cold 데이터 | 250 | 250 MB/s |

### S3 접근 제어 방식 비교

| 방식 | 범위 | 형식 | 주요 사용 사례 |
|:---:|:---:|:---:|:---:|
| **IAM 정책** | 사용자/역할 | JSON | 내부 사용자 권한 관리 |
| **버킷 정책** | 버킷 | JSON | 교차 계정 접근, 조건부 접근 |
| **ACL** | 버킷/객체 | XML | 퍼블릭 접근 (비권장) |
| **Block Public Access** | 계정/버킷 | 설정 | 퍼블릭 노출 방지 |
| **VPC Endpoint 정책** | 엔드포인트 | JSON | 특정 버킷만 접근 허용 |

### SOC 관점 주요 모니터링 이벤트

| CloudTrail 이벤트 | 의미 | 위험도 |
|:---:|:---:|:---:|
| `PutBucketPolicy` | 버킷 정책 변경 | 🔴 높음 |
| `PutBucketAcl` | ACL 변경 | 🔴 높음 |
| `DeleteBucketEncryption` | 암호화 비활성화 | 🔴 높음 |
| `PutBucketPublicAccessBlock` | 퍼블릭 접근 설정 변경 | 🔴 높음 |
| `ModifySnapshotAttribute` | EBS 스냅샷 공유 범위 변경 | 🟠 중간 |
| `CreateSnapshot` / `DeleteSnapshot` | 스냅샷 생성/삭제 | 🟡 낮음 |
| `PutBucketVersioning` | 버전 관리 설정 변경 | 🟠 중간 |